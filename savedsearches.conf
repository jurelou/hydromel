
[Ruby on Rails Framework Exceptions]
#Global options
disabled = false
search = index=windows_evtx ("ActionController::InvalidAuthenticityToken" OR "ActionController::InvalidCrossOriginRequest" OR "ActionController::MethodNotAllowed" OR "ActionController::BadRequest" OR "ActionController::ParameterMissing") | stats values(*) AS * by _time 

#Scheduling options
enableSched = true
cron_schedule = */5 * * * *
allow_skew = 50%
schedule_window = auto

#Notification options
counttype = number of events
relation = greater than
quantity = 0

#Settings for summary index action
action.summary_index = true
action.summary_index._name = chouchen-sigma-hunting
action.summary_index.sigma_tags = attack.initial_access
action.summary_index.sigma_tags = attack.t1190
action.summary_index.attack_ID = t1190

#dispatch search options
dispatch.earliest_time = -5m
dispatch.latest_time = now

#alert settings
alert.suppress = false
alert.severity = 4
alert.track = true
alert.expires = 24h

#UI-specific settings
request.ui_dispatch_app = TA-chouchen
request.ui_dispatch_view = search
description = "Detects suspicious Ruby on Rails exceptions that could indicate exploitation attempts"

[Django Framework Exceptions]
#Global options
disabled = false
search = index=windows_evtx ("SuspiciousOperation" OR "DisallowedHost" OR "DisallowedModelAdminLookup" OR "DisallowedModelAdminToField" OR "DisallowedRedirect" OR "InvalidSessionKey" OR "RequestDataTooBig" OR "SuspiciousFileOperation" OR "SuspiciousMultipartForm" OR "SuspiciousSession" OR "TooManyFieldsSent" OR "PermissionDenied") | stats values(*) AS * by _time 

#Scheduling options
enableSched = true
cron_schedule = */5 * * * *
allow_skew = 50%
schedule_window = auto

#Notification options
counttype = number of events
relation = greater than
quantity = 0

#Settings for summary index action
action.summary_index = true
action.summary_index._name = chouchen-sigma-hunting
action.summary_index.sigma_tags = attack.initial_access
action.summary_index.sigma_tags = attack.t1190
action.summary_index.attack_ID = t1190

#dispatch search options
dispatch.earliest_time = -5m
dispatch.latest_time = now

#alert settings
alert.suppress = false
alert.severity = 4
alert.track = true
alert.expires = 24h

#UI-specific settings
request.ui_dispatch_app = TA-chouchen
request.ui_dispatch_view = search
description = "Detects suspicious Django web application framework exceptions that could indicate exploitation attempts"

[Spring Framework Exceptions]
#Global options
disabled = false
search = index=windows_evtx ("AccessDeniedException" OR "CsrfException" OR "InvalidCsrfTokenException" OR "MissingCsrfTokenException" OR "CookieTheftException" OR "InvalidCookieException" OR "RequestRejectedException") | stats values(*) AS * by _time 

#Scheduling options
enableSched = true
cron_schedule = */5 * * * *
allow_skew = 50%
schedule_window = auto

#Notification options
counttype = number of events
relation = greater than
quantity = 0

#Settings for summary index action
action.summary_index = true
action.summary_index._name = chouchen-sigma-hunting
action.summary_index.sigma_tags = attack.initial_access
action.summary_index.sigma_tags = attack.t1190
action.summary_index.attack_ID = t1190

#dispatch search options
dispatch.earliest_time = -5m
dispatch.latest_time = now

#alert settings
alert.suppress = false
alert.severity = 4
alert.track = true
alert.expires = 24h

#UI-specific settings
request.ui_dispatch_app = TA-chouchen
request.ui_dispatch_view = search
description = "Detects suspicious Spring framework exceptions that could indicate exploitation attempts"

[Brute Force]
#Global options
disabled = false
search = index=windows_evtx action="failure" | eventstats dc(category) as val by dst_ip | search val > 30 | stats values(*) AS * by _time 

#Scheduling options
enableSched = true
cron_schedule = */5 * * * *
allow_skew = 50%
schedule_window = auto

#Notification options
counttype = number of events
relation = greater than
quantity = 0

#Settings for summary index action
action.summary_index = true
action.summary_index._name = chouchen-sigma-hunting
action.summary_index.sigma_tags = attack.credential_access
action.summary_index.sigma_tags = attack.t1110
action.summary_index.attack_ID = t1110

#dispatch search options
dispatch.earliest_time = -5m
dispatch.latest_time = now

#alert settings
alert.suppress = false
alert.severity = 4
alert.track = true
alert.expires = 24h

#UI-specific settings
request.ui_dispatch_app = TA-chouchen
request.ui_dispatch_view = search
description = "Detects many authentication failures from one source to one destination which is may indicate Brute Force activity"

[Python SQL Exceptions]
#Global options
disabled = false
search = index=windows_evtx ("DataError" OR "IntegrityError" OR "ProgrammingError" OR "OperationalError") | stats values(*) AS * by _time 

#Scheduling options
enableSched = true
cron_schedule = */5 * * * *
allow_skew = 50%
schedule_window = auto

#Notification options
counttype = number of events
relation = greater than
quantity = 0

#Settings for summary index action
action.summary_index = true
action.summary_index._name = chouchen-sigma-hunting
action.summary_index.sigma_tags = attack.initial_access
action.summary_index.sigma_tags = attack.t1190
action.summary_index.attack_ID = t1190

#dispatch search options
dispatch.earliest_time = -5m
dispatch.latest_time = now

#alert settings
alert.suppress = false
alert.severity = 4
alert.track = true
alert.expires = 24h

#UI-specific settings
request.ui_dispatch_app = TA-chouchen
request.ui_dispatch_view = search
description = "Generic rule for SQL exceptions in Python according to PEP 249"

[Suspicious SQL Error Messages]
#Global options
disabled = false
search = index=windows_evtx ("quoted string not properly terminated" OR "You have an error in your SQL syntax" OR "Unclosed quotation mark" OR "near \"*\": syntax error" OR "SELECTs to the left and right of UNION do not have the same number of result columns") | stats values(*) AS * by _time 

#Scheduling options
enableSched = true
cron_schedule = */5 * * * *
allow_skew = 50%
schedule_window = auto

#Notification options
counttype = number of events
relation = greater than
quantity = 0

#Settings for summary index action
action.summary_index = true
action.summary_index._name = chouchen-sigma-hunting
action.summary_index.sigma_tags = attack.initial_access
action.summary_index.sigma_tags = attack.t1190
action.summary_index.attack_ID = t1190

#dispatch search options
dispatch.earliest_time = -5m
dispatch.latest_time = now

#alert settings
alert.suppress = false
alert.severity = 4
alert.track = true
alert.expires = 24h

#UI-specific settings
request.ui_dispatch_app = TA-chouchen
request.ui_dispatch_view = search
description = "Detects SQL error messages that indicate probing for an injection attack"
